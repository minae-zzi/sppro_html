<!DOCTYPE html>
<html lang="ko" data-theme="mytheme">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 기본 메타 태그 -->
    <meta name="description" content="Ms SearchPro" />
    <meta name="keywords" content="Ms SearchPro" />
    <meta name="author" content="Ms SearchPro" />

    <!-- 파비콘 -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../../images/favicon.ico"
    />

    <title>Ms SearchPro</title>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Tailwind CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <link rel="stylesheet" href="../../css/theme.css" />
    <style type="text/tailwindcss">
      @theme {
        --font-display: "Pretendard", "sans-serif";
        --color-bgGray: #f6f7fa;
        --color-formGray: #eeeff4;
        --color-pblue: #5c7dee;
        --color-contentGray: #eeeff4;
        --color-pgreen: #70c3a7;
      }
    </style>
  </head>
  <body>
    <div id="wrap" class="flex flex-row">
      <!-- GNB include -->
      <div id="gnb"></div>
      <div class="h-full w-full p-4 md:p-10">
        <!-- 타이틀 불러오기 -->
        <h1 class="flex justify-between items-start pb-2 pt-2 md:pt-0 md:pb-6">
          <div>
            <span
              id="pageTitle"
              class="block text-2xl md:text-4xl font-bold opacity-0 transition-opacity duration-100 md:min-h-[48px]"
            >
              <!-- JS로 동적 텍스트 삽입 -->
            </span>

            <div class="breadcrumbs text-sm min-h-[24px]">
              <ul class="font-normal text-zinc-500">
                <li id="breadcrumbDepth1">&nbsp;</li>
                <li id="breadcrumbDepth2">&nbsp;</li>
                <li id="breadcrumbDepth3">&nbsp;</li>
              </ul>
            </div>
          </div>

          <div id="topbt"></div>
        </h1>

        <!-- 컨텐츠 -->
        <div id="content">
          <!-- 견적서 상세 컴포넌트 -->
          <div id="estimateHeader"></div>
          <div id="estimateAnswer"></div>

          <script>
            $(document).ready(function () {
              $("#estimateHeader").load(
                "/page/mypage/estimate-detail-header.html"
              );
              $("#estimateAnswer").load(
                "/page/mypage/estimate-detail-answer.html"
              );
            });
          </script>

          <!-- PrevEstimate: 정적 HTML 구현 -->
          <!-- 견적 카드 리스트 -->
          <div class="flex flex-col gap-4" id="estimateList">
            <div class="text-sm text-zinc-500">
              총 <strong>2</strong>건의 견적 내역입니다.
            </div>

            <!-- 견적 카드 1 -->
            <div class="bg-formGray rounded-md estimate-card">
              <div
                class="flex items-center pb-2 gap-2 justify-between px-6 py-4"
              >
                <div class="flex items-center gap-2">
                  <div class="text-xs text-pblue font-semibold">재견적</div>
                  <p class="text-zinc-400 text-sm">2025-00-0001</p>
                </div>
                <button
                  class="toggle-estimate text-xs text-white rounded-md px-4 py-1.5 bg-neutral-800"
                  data-target="detail-1"
                >
                  견적서 상세보기
                </button>
              </div>

              <div class="flex justify-start items-center gap-2 px-6">
                <div
                  class="bg-zinc-200 rounded-sm p-1.5 px-2 text-xs font-semibold"
                >
                  국내
                </div>
                <div>2025년 상반기 국내조사</div>
              </div>

              <div
                class="text-sm text-zinc-400 flex justify-start border-t border-zinc-200 py-3 px-6 mt-4 gap-2"
              >
                <p>작성일</p>
                <p class="text-zinc-600">2025-03-20 13:45:00</p>
              </div>

              <!-- 펼침 영역 -->
              <div
                id="detail-1"
                class="estimate-detail overflow-hidden"
                style="height: 0; opacity: 0"
              >
                <div class="border-t border-zinc-200">
                  <div
                    class="flex px-5 py-4 justify-start items-center gap-2 border-b border-gray-200 text-sm"
                  >
                    <p class="w-[80px] font-semibold text-zinc-800 pl-1">
                      파트너사
                    </p>
                    <div class="text-zinc-500">dataspring, gmor</div>
                  </div>

                  <div
                    class="flex px-5 py-4 justify-start gap-2 border-b border-gray-200 text-sm"
                  >
                    <p class="w-[80px] font-semibold text-zinc-800 pl-1">
                      본문
                    </p>
                    <div class="text-zinc-500 whitespace-pre-wrap">
                      1. 샘플 수 : 1000명 2. 국가 : 국내 3. 조건 : 성/연령/지역
                      기준 4. 설문길이 : 15분
                    </div>
                  </div>

                  <div
                    class="flex px-5 py-4 justify-start gap-2 border-b border-gray-200 text-sm"
                  >
                    <p class="w-[80px] font-semibold text-zinc-800 pl-1">
                      참조
                    </p>
                    <div class="text-zinc-500">someone@email.com</div>
                  </div>

                  <div
                    class="flex px-5 py-4 justify-start gap-2 border-b border-gray-200 text-sm"
                  >
                    <p class="w-[80px] font-semibold text-zinc-800 pl-1">
                      첨부파일
                    </p>
                    <div class="text-zinc-500">
                      <a href="#" download class="hover:text-pblue-dark"
                        >brief.pdf</a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              document.querySelectorAll(".toggle-detail").forEach((btn) => {
                btn.addEventListener("click", () => {
                  const detail = btn
                    .closest(".bg-formGray")
                    .querySelector(".detail-area");
                  detail.classList.toggle("hidden");
                  btn.textContent = detail.classList.contains("hidden")
                    ? "견적서 상세보기"
                    : "견적서 상세닫기";
                });
              });
            });
          </script>

          <!-- GSAP 애니메이션 스크립트 -->
          <script>
            document.addEventListener("DOMContentLoaded", () => {
              const toggles = document.querySelectorAll(".toggle-estimate");

              toggles.forEach((toggle) => {
                toggle.addEventListener("click", () => {
                  const targetId = toggle.dataset.target;
                  const detail = document.getElementById(targetId);

                  const isOpen = detail.classList.contains("open");

                  if (isOpen) {
                    gsap.to(detail, {
                      height: 0,
                      opacity: 0,
                      duration: 0.4,
                      ease: "power2.inOut",
                      onComplete: () => {
                        detail.classList.remove("open");
                      },
                    });
                    toggle.textContent = "견적서 상세보기";
                  } else {
                    // 높이 자동 계산
                    detail.style.display = "block";
                    detail.style.height = "auto";
                    const fullHeight = detail.scrollHeight;
                    detail.style.height = "0";

                    gsap.to(detail, {
                      height: fullHeight,
                      opacity: 1,
                      duration: 0.4,
                      ease: "power2.out",
                      onStart: () => {
                        detail.classList.add("open");
                      },
                      onComplete: () => {
                        detail.style.height = "auto";
                      },
                    });
                    toggle.textContent = "견적서 상세닫기";
                  }
                });
              });
            });
          </script>
        </div>
      </div>
    </div>

    <script>
      // GNB 로드 후 필요한 스크립트들 순차 로딩
      $("#gnb").load("../../common/gnb.html", function () {
        // animation.js
        const animScript = document.createElement("script");
        animScript.src = "../../js/animation.js";
        animScript.onload = () => {
          initAnimations?.(); // 애니메이션 초기화
        };
        document.body.appendChild(animScript);

        // breadcrumb.js
        const breadcrumbScript = document.createElement("script");
        breadcrumbScript.src = "../../js/breadcrumb.js";
        breadcrumbScript.onload = () => {
          setBreadcrumbByPath?.(); // 타이틀 & 브레드크럼 설정
        };
        document.body.appendChild(breadcrumbScript);

        // active-gnb.js
        const gnbScript = document.createElement("script");
        gnbScript.src = "../../js/active-gnb.js";
        gnbScript.onload = () => {
          setActiveGNB?.(); // GNB 활성화 표시
        };
        document.body.appendChild(gnbScript);
      });

      $("#topbt").load("../../common/topbt.html", function () {
        $("#topbt").hide().fadeIn(50);
      });
    </script>
  </body>
</html>
